# Application Environment Variables
# Copy this file to .env and update as needed

# ==========================================
# BACKEND CONFIGURATION
# ==========================================

# Server port (Railway auto-sets this, but local development uses 3001)
PORT=3001

# Node environment
NODE_ENV=development

# Frontend URL (used for CORS)
# Local: http://localhost:5173
# Production: https://yourdomain.railway.app
CLIENT_BASE_URL=http://localhost:5173

# Frontend API Configuration
REACT_APP_BACKEND_URL=http://localhost:3001

# Strava API Credentials
# Get these from https://www.strava.com/settings/api
STRAVA_CLIENT_ID=your_client_id_here
STRAVA_CLIENT_SECRET=your_client_secret_here

# OAuth Redirect URI
# Local: http://localhost:3001/auth/strava/callback
# Production: https://yourdomain.railway.app/auth/strava/callback
STRAVA_REDIRECT_URI=http://localhost:3001/auth/strava/callback

# Database path
DATABASE_PATH=./data/wmv.db

# Session Secret (generate with: openssl rand -base64 32 or node -e "console.log(require('crypto').randomBytes(32).toString('base64'))")
SESSION_SECRET=your-random-secret-here

# Token Encryption Key (generate with: openssl rand -hex 32 or node -e "console.log(require('crypto').randomBytes(32).toString('hex'))")
# Used to encrypt OAuth tokens at rest in database
TOKEN_ENCRYPTION_KEY=your-random-hex-here

# Strava API Base URL (for webhook subscription calls)
# Development: http://localhost:4000 (when running mock-strava)
# Production: https://www.strava.com (real Strava)
STRAVA_API_BASE_URL=https://www.strava.com

# Admin Athlete IDs (comma-separated list of Strava athlete IDs who should be admins)
# Find your Strava athlete ID: https://www.strava.com/settings/profile (look at URL)
# Example: ADMIN_ATHLETE_IDS=12345678,87654321
# If empty, no one has admin access (safe default)
ADMIN_ATHLETE_IDS=

# ==========================================
# WEBHOOK CONFIGURATION (Optional)
# ==========================================

# Enable Strava webhook subscriptions for real-time activity updates
# Set to 'true' to enable, 'false' or unset to disable (default: disabled)
# If disabled, use admin "Fetch Results" button to manually collect activities
WEBHOOK_ENABLED=false

# Webhook Verification Token (required if WEBHOOK_ENABLED=true)
# Random string used to verify requests are from Strava
# Generate with: openssl rand -base64 32 or node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
# Keep this secret - only Strava and your app should know it
WEBHOOK_VERIFY_TOKEN=

# Webhook Callback URL (required if WEBHOOK_ENABLED=true)
# Public HTTPS URL where Strava sends webhook events
# Must be:
#   - HTTPS (not HTTP - Strava requires it)
#   - Publicly accessible (your app must be on the internet)
#   - On a public domain (not localhost)
# Examples:
#   - Local testing: Use tunneling service like ngrok (https://ngrok.com)
#     See docs/WEBHOOKS.md for ngrok setup instructions
#   - Production: https://yourdomain.railway.app/webhooks/strava
# The app will send requests to: {WEBHOOK_CALLBACK_URL}/webhooks/strava
WEBHOOK_CALLBACK_URL=

# Persist webhook events to database (REQUIRED if WEBHOOK_ENABLED=true)
# If true, all webhook events are persisted to database (webhook_event table)
# Events are marked as processed (success) or failed (with error message)
# Required for admin dashboard webhook status metrics
# Can be checked with:
#   SELECT * FROM webhook_event ORDER BY created_at DESC LIMIT 20;
# Set to 'true' when webhooks enabled, 'false' otherwise (default: false)
WEBHOOK_PERSIST_EVENTS=false

